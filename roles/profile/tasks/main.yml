---
- name: 'clean managed drop-ins directory'
  file:
    path: '{{ user_config["home_dir"] }}/{{ user_config["profile_dropins_dir"] }}'
    state: 'absent'

- name: 'ensure drop-ins directories exist'
  loop:
    - '{{ user_config["profile_dropins_dir"] }}'
    - '{{ user_config["profile_dropins_dir"] }}-unmanaged'
  file:
    path: '{{ user_config["home_dir"] }}/{{ item }}'
    owner: '{{ user_config["name"] }}'
    group: '{{ user_config["name"] }}'
    state: 'directory'
    mode: 0755

- name: 'install basic .profile'
  template:
    src: 'profile.j2'
    dest: '{{ user_config["home_dir"] }}/.profile'
    owner: '{{ user_config["name"] }}'
    group: '{{ user_config["name"] }}'
    mode: 0644

- name: 'install basic drop-ins'
  copy:
    src: 'dropins/'
    dest: '{{ user_config["home_dir"] }}/{{ user_config["profile_dropins_dir"] }}'
    owner: '{{ user_config["name"] }}'
    group: '{{ user_config["name"] }}'
    mode: 0644
