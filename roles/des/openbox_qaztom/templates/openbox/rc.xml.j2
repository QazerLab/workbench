<?xml version="1.0" encoding="UTF-8"?>

<openbox_config xmlns="http://openbox.org/3.4/rc" xmlns:xi="http://www.w3.org/2001/XInclude">
    <resistance>
        <strength>25</strength>
        <screen_edge_strength>50</screen_edge_strength>
    </resistance>

    <focus>
        <focusNew>yes</focusNew>
        <followMouse>no</followMouse>
        <focusLast>yes</focusLast>
        <underMouse>no</underMouse>
        <focusDelay>200</focusDelay>
        <raiseOnFocus>no</raiseOnFocus>
    </focus>

    <placement>
        <policy>Smart</policy>
        <monitor>Primary</monitor>
        <primaryMonitor>1</primaryMonitor>
    </placement>

    <theme>
        <name>Clearlooks</name>
        <titleLayout>NLIMC</titleLayout>
        <keepBorder>yes</keepBorder>
        <animateIconify>yes</animateIconify>
        <font place="ActiveWindow">
            <name>Century Schoolbook L</name>
            <size>8</size>
            <weight>bold</weight>
            <slant>italic</slant>
        </font>
        <font place="InactiveWindow">
            <name>Century Schoolbook L</name>
            <size>8</size>
            <weight>bold</weight>
            <slant>italic</slant>
        </font>
        <font place="MenuHeader">
            <name>Century Schoolbook L</name>
            <size>10</size>
            <weight>normal</weight>
            <slant>italic</slant>
        </font>
        <font place="MenuItem">
            <name>Century Schoolbook L</name>
            <size>10</size>
            <weight>normal</weight>
            <slant>italic</slant>
        </font>
        <font place="ActiveOnScreenDisplay">
            <name>Century Schoolbook L</name>
            <size>9</size>
            <weight>bold</weight>
            <slant>italic</slant>
        </font>
        <font place="InactiveOnScreenDisplay">
            <name>Century Schoolbook L</name>
            <size>9</size>
            <weight>bold</weight>
            <slant>italic</slant>
        </font>
    </theme>

    <desktops>
        <number>4</number>
        <firstdesk>1</firstdesk>
        <popupTime>875</popupTime>
        <names/>
    </desktops>

    <resize>
        <drawContents>yes</drawContents>
        <popupShow>Nonpixel</popupShow>
        <popupPosition>Center</popupPosition>

        <!-- these are used if popupPosition is set to 'Fixed' -->
        <popupFixedPosition>
            <x>10</x>
            <y>10</y>
        </popupFixedPosition>
    </resize>

    <margins>
        <top>0</top>
        <bottom>0</bottom>
        <left>0</left>
        <right>0</right>
    </margins>

    <dock>
        <position>TopLeft</position>
        <floatingX>0</floatingX>
        <floatingY>0</floatingY>
        <noStrut>no</noStrut>
        <stacking>Above</stacking>
        <direction>Vertical</direction>
        <autoHide>no</autoHide>
        <hideDelay>300</hideDelay>
        <showDelay>300</showDelay>
        <moveButton>Middle</moveButton>
    </dock>

    <keyboard>
        <chainQuitKey>C-g</chainQuitKey>

        <!--
            Desktops management section.
            Some hotkeys are duplicated to use both arrows and hjkl keys.
        -->

        <keybind key="W-h">
            <action name="GoToDesktop">
                <to>left</to>
                <wrap>no</wrap>
            </action>
        </keybind>
        <keybind key="W-l">
            <action name="GoToDesktop">
                <to>right</to>
                <wrap>no</wrap>
            </action>
        </keybind>
        <keybind key="W-Left">
            <action name="GoToDesktop">
                <to>left</to>
                <wrap>no</wrap>
            </action>
        </keybind>
        <keybind key="W-Right">
            <action name="GoToDesktop">
                <to>right</to>
                <wrap>no</wrap>
            </action>
        </keybind>
        <keybind key="W-u">
            <action name="SendToDesktop">
                <to>left</to>
                <wrap>no</wrap>
            </action>
        </keybind>

        <!-- TODO: make optional (enable for laptops only; provide the script) -->
        <keybind key="W-i">
            <action name="Execute">
                <command>fix-mon</command>
            </action>
        </keybind>

        <keybind key="W-o">
            <action name="SendToDesktop">
                <to>right</to>
                <wrap>no</wrap>
            </action>
        </keybind>
        <keybind key="W-1">
            <action name="GoToDesktop">
                <to>1</to>
            </action>
        </keybind>
        <keybind key="W-2">
            <action name="GoToDesktop">
                <to>2</to>
            </action>
        </keybind>
        <keybind key="W-3">
            <action name="GoToDesktop">
                <to>3</to>
            </action>
        </keybind>
        <keybind key="W-4">
            <action name="GoToDesktop">
                <to>4</to>
            </action>
        </keybind>

        <!--
            Windows management section.
        -->

        <keybind key="W-Tab">
            <action name="NextWindow">
                <finalactions>
                    <action name="Focus"/>
                    <action name="Raise"/>
                    <action name="Unshade"/>
                </finalactions>
            </action>
        </keybind>
        <keybind key="W-S-Tab">
            <action name="PreviousWindow">
                <finalactions>
                    <action name="Focus"/>
                    <action name="Raise"/>
                    <action name="Unshade"/>
                </finalactions>
            </action>
        </keybind>
        <keybind key="A-Tab">
            <action name="NextWindow">
                <finalactions>
                    <action name="Focus"/>
                    <action name="Raise"/>
                    <action name="Unshade"/>
                </finalactions>
            </action>
        </keybind>
        <keybind key="A-S-Tab">
            <action name="PreviousWindow">
                <finalactions>
                    <action name="Focus"/>
                    <action name="Raise"/>
                    <action name="Unshade"/>
                </finalactions>
            </action>
        </keybind>
        <keybind key="W-w">
            <action name="Close"/>
        </keybind>
        <keybind key="A-F4">
            <action name="Close"/>
        </keybind>
        <keybind key="W-e">
            <action name="ShowMenu">
                <menu>client-menu</menu>
            </action>
        </keybind>
        <keybind key="W-a">
            <action name="ToggleMaximize"/>
        </keybind>
        <keybind key="W-Up">
            <action name="Maximize"/>
        </keybind>
        <keybind key="W-Down">
            <action name="Unmaximize"/>
        </keybind>
        <keybind key="W-k">
            <action name="Maximize"/>
        </keybind>
        <keybind key="W-j">
            <action name="Unmaximize"/>
        </keybind>
        <keybind key="W-d">
            <action name="ToggleShowDesktop"/>
        </keybind>
        <keybind key="W-f">
            <action name="ToggleFullscreen"/>
        </keybind>
        <keybind key="W-z">
            <action name="MoveToEdge">
                <direction>west</direction>
            </action>
        </keybind>
        <keybind key="W-x">
            <action name="MoveToEdge">
                <direction>south</direction>
            </action>
        </keybind>
        <keybind key="W-c">
            <action name="MoveToEdge">
                <direction>north</direction>
            </action>
        </keybind>
        <keybind key="W-v">
            <action name="MoveToEdge">
                <direction>east</direction>
            </action>
        </keybind>
        <keybind key="W-n">
            <action name="Resize"/>
        </keybind>
        <keybind key="W-m">
            <action name="Move"/>
        </keybind>

        <!--
            Volume control section.

            XXX: While it would be better to control sound at ALSA level, there are problems
            which make this difficult, so we resort to regulating the default sink of PulseAudio
            and hope that this will always work as expected.

            See also:

            https://wiki.archlinux.org/title/PulseAudio/Troubleshooting#Output_stuck_muted_while_Master_is_toggled
        -->
        <keybind key="W-period">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-volume $(pactl get-default-sink) +10%'</command>
            </action>
        </keybind>
        <keybind key="W-comma">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-volume $(pactl get-default-sink) -10%'</command>
            </action>
        </keybind>
        <keybind key="W-slash">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-mute $(pactl get-default-sink) toggle'</command>
            </action>
        </keybind>

        <keybind key="XF86AudioRaiseVolume">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-volume $(pactl get-default-sink) +10%'</command>
            </action>
        </keybind>
        <keybind key="XF86AudioLowerVolume">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-volume $(pactl get-default-sink) -10%'</command>
            </action>
        </keybind>
        <keybind key="XF86AudioMute">
            <action name="Execute">
                <command>sh -c 'pactl set-sink-mute $(pactl get-default-sink) toggle'</command>
            </action>
        </keybind>

        <!--
            System session management section.
        -->

{% if 'dm' in system.gui and system.gui.dm == 'lightdm' %}
        <keybind key="W-semicolon">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>lock</name>
                </startupnotify>
                <command>light-locker-command -l</command>
            </action>
        </keybind>
{% endif %}
        <keybind key="W-q">
            <action name="Reconfigure"/>
        </keybind>
        <keybind key="W-Escape">
            <action name="Execute">
                <command>sudo systemctl poweroff</command>
            </action>
        </keybind>
        <keybind key="C-W-Escape">
            <action name="Execute">
                <command>sudo systemctl reboot</command>
            </action>
        </keybind>
        <keybind key="W-Delete">
            <action name="Execute">
                <command>sudo systemctl reboot</command>
            </action>
        </keybind>
        <keybind key="W-BackSpace">
            <action name="Execute">
                <command>systemctl suspend</command>
            </action>
        </keybind>
        <keybind key="C-W-BackSpace">
            <action name="Execute">
                <command>systemctl hibernate</command>
            </action>
        </keybind>

        <!--
            Application launchers section.
        -->

        <keybind key="W-Print">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Shot</name>
                </startupnotify>
                <command>xfce4-screenshooter</command>
            </action>
        </keybind>

{% if 'admin_network' in user_config.toolchains %}
        <keybind key="C-W-w">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Wireshark</name>
                </startupnotify>
                <command>wireshark</command>
            </action>
        </keybind>
{% endif %}

{% if 'sublime' in user_config.apps %}
        <keybind key="C-W-e">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Sublime</name>
                </startupnotify>
                <command>subl</command>
            </action>
        </keybind>
{% endif %}

{% if 'transmission' in user_config.apps %}
        <keybind key="C-W-t">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Transmission</name>
                </startupnotify>
{% if system.hidpi %}
                <command>env GDK_SCALE=1 transmission-gtk</command>
{% else %}
                <command>transmission-gtk</command>
{% endif %}
            </action>
        </keybind>
{% endif %}

        <keybind key="W-t">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Terminal</name>
                </startupnotify>
                <command>alacritty</command>
            </action>
        </keybind>

{% if 'vivaldi' in user_config.apps %}
        <keybind key="C-W-o">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Vivaldi</name>
                </startupnotify>
                <command>vivaldi-stable</command>
            </action>
        </keybind>
{% endif %}

{% if 'skype' in user_config.apps %}
        <keybind key="C-W-s">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Skype</name>
                </startupnotify>
                <command>skypeforlinux</command>
            </action>
        </keybind>
${% endif %}

{% if 'doublecmd' in user_config.apps %}
        <keybind key="C-W-d">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>DoubleCmd</name>
                </startupnotify>
                <command>doublecmd</command>
            </action>
        </keybind>
{% endif %}

        <!-- TODO: make optional app? -->
        <keybind key="C-W-f">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Firefox</name>
                </startupnotify>
                <command>firefox</command>
            </action>
        </keybind>

{% if 'media' in user_config.toolchains %}
        <keybind key="C-W-g">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Gimp</name>
                </startupnotify>
                <command>gimp</command>
            </action>
        </keybind>
{% endif %}

        <!-- TODO: make optional app? -->
        <keybind key="C-W-l">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Slack</name>
                </startupnotify>
                <command>slack</command>
            </action>
        </keybind>

        <keybind key="C-W-c">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Calc</name>
                </startupnotify>
                <command>galculator</command>
            </action>
        </keybind>
        <keybind key="XF86Calculator">
            <action name="Execute">
                <command>galculator</command>
            </action>
        </keybind>

{% if 'devel_java' in user_config.toolchains %}
        <keybind key="C-W-v">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>VisualVM</name>
                </startupnotify>
                <command>visualvm</command>
            </action>
        </keybind>
        <keybind key="C-W-n">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Netbeans</name>
                </startupnotify>
{% if system.hidpi %}
                <command>sh -c 'export GDK_SCALE=3; exec netbeans'</command>
{% else %}
                <command>netbeans</command>
{% endif %}
            </action>
        </keybind>
{% endif %}

        <!-- TODO: make optional app? -->
        <keybind key="C-W-m">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>Chromium</name>
                </startupnotify>
                <command>chromium</command>
            </action>
        </keybind>

        <!--
            Misc.
        -->

        <keybind key="W-r">
            <action name="Execute">
                <startupnotify>
                    <enabled>true</enabled>
                    <name>gmrun</name>
                </startupnotify>
                <command>gmrun</command>
            </action>
        </keybind>
    </keyboard>

    <mouse>
        <dragThreshold>1</dragThreshold>
        <doubleClickTime>500</doubleClickTime>
        <screenEdgeWarpTime>400</screenEdgeWarpTime>
        <screenEdgeWarpMouse>false</screenEdgeWarpMouse>
        <context name="Frame">
            <mousebind button="A-Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="A-Left" action="Click">
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="A-Left" action="Drag">
                <action name="Move"/>
            </mousebind>
            <mousebind button="A-Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="A-Right" action="Drag">
                <action name="Resize"/>
            </mousebind>
            <mousebind button="A-Middle" action="Press">
                <action name="Lower"/>
                <action name="FocusToBottom"/>
                <action name="Unfocus"/>
            </mousebind>
            <mousebind button="A-Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="A-Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
            <mousebind button="C-A-Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="C-A-Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
            <mousebind button="A-S-Up" action="Click">
                <action name="SendToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="A-S-Down" action="Click">
                <action name="SendToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
        </context>
        <context name="Titlebar">
            <mousebind button="Left" action="Drag">
                <action name="Move"/>
            </mousebind>
            <mousebind button="Left" action="DoubleClick">
                <action name="ToggleMaximize"/>
            </mousebind>
            <mousebind button="Up" action="Click">
                <action name="if">
                    <shaded>no</shaded>
                    <then>
                        <action name="Shade"/>
                        <action name="FocusToBottom"/>
                        <action name="Unfocus"/>
                        <action name="Lower"/>
                    </then>
                </action>
            </mousebind>
            <mousebind button="Down" action="Click">
                <action name="if">
                    <shaded>yes</shaded>
                    <then>
                        <action name="Unshade"/>
                        <action name="Raise"/>
                    </then>
                </action>
            </mousebind>
        </context>
        <context name="Titlebar Top Right Bottom Left TLCorner TRCorner BRCorner BLCorner">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Middle" action="Press">
                <action name="Lower"/>
                <action name="FocusToBottom"/>
                <action name="Unfocus"/>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="ShowMenu">
                    <menu>client-menu</menu>
                </action>
            </mousebind>
        </context>
        <context name="Top">
            <mousebind button="Left" action="Drag">
                <action name="Resize">
                    <edge>top</edge>
                </action>
            </mousebind>
        </context>
        <context name="Left">
            <mousebind button="Left" action="Drag">
                <action name="Resize">
                    <edge>left</edge>
                </action>
            </mousebind>
        </context>
        <context name="Right">
            <mousebind button="Left" action="Drag">
                <action name="Resize">
                    <edge>right</edge>
                </action>
            </mousebind>
        </context>
        <context name="Bottom">
            <mousebind button="Left" action="Drag">
                <action name="Resize">
                    <edge>bottom</edge>
                </action>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="ShowMenu">
                    <menu>client-menu</menu>
                </action>
            </mousebind>
        </context>
        <context name="TRCorner BRCorner TLCorner BLCorner">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Left" action="Drag">
                <action name="Resize"/>
            </mousebind>
        </context>
        <context name="Client">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="Middle" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
        </context>
        <context name="Icon">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
                <action name="ShowMenu">
                    <menu>client-menu</menu>
                </action>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="ShowMenu">
                    <menu>client-menu</menu>
                </action>
            </mousebind>
        </context>
        <context name="AllDesktops">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Left" action="Click">
                <action name="ToggleOmnipresent"/>
            </mousebind>
        </context>
        <context name="Shade">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="Left" action="Click">
                <action name="ToggleShade"/>
            </mousebind>
        </context>
        <context name="Iconify">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="Left" action="Click">
                <action name="Iconify"/>
            </mousebind>
        </context>
        <context name="Maximize">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Middle" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Left" action="Click">
                <action name="ToggleMaximize"/>
            </mousebind>
            <mousebind button="Middle" action="Click">
                <action name="ToggleMaximize">
                    <direction>vertical</direction>
                </action>
            </mousebind>
            <mousebind button="Right" action="Click">
                <action name="ToggleMaximize">
                    <direction>horizontal</direction>
                </action>
            </mousebind>
        </context>
        <context name="Close">
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
                <action name="Unshade"/>
            </mousebind>
            <mousebind button="Left" action="Click">
                <action name="Close"/>
            </mousebind>
        </context>
        <context name="Desktop">
            <mousebind button="A-Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="A-Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
            <mousebind button="C-A-Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="C-A-Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
            <mousebind button="Left" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="Focus"/>
                <action name="Raise"/>
            </mousebind>
        </context>
        <context name="Root">
            <!-- Menus -->
            <mousebind button="Middle" action="Press">
                <action name="ShowMenu">
                    <menu>client-list-combined-menu</menu>
                </action>
            </mousebind>
            <mousebind button="Right" action="Press">
                <action name="ShowMenu">
                    <menu>root-menu</menu>
                </action>
            </mousebind>
        </context>
        <context name="MoveResize">
            <mousebind button="Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
            <mousebind button="A-Up" action="Click">
                <action name="GoToDesktop">
                    <to>previous</to>
                </action>
            </mousebind>
            <mousebind button="A-Down" action="Click">
                <action name="GoToDesktop">
                    <to>next</to>
                </action>
            </mousebind>
        </context>
    </mouse>

    <menu>
        <file>menu.xml</file>
        <hideDelay>200</hideDelay>
        <middle>no</middle>
        <submenuShowDelay>100</submenuShowDelay>
        <submenuHideDelay>400</submenuHideDelay>
        <showIcons>yes</showIcons>
        <manageDesktops>yes</manageDesktops>
    </menu>

    <!-- TODO: make optional depending on feature flags -->
    <applications>
        <application class="firefox">
            <decor>no</decor>
        </application>
    </applications>
</openbox_config>
